---
title: "Nestorowa Gene Expression Data: Dimension Reduction"
author: "Michelle Li"
date: "6/29/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(rgl)
options(rgl.useNULL = TRUE)
r3dDefaults$windowRect <- c(0,0,1000,1000)
```

----

## PCA (Handwritten)

This is the handwritten version of PCA in R, I used SVD for everything (not eig).

## Nestorowa Data

```{r pca-nestorowa}
## read in data, convert to matrix
rawdata <- read.delim("~/GitHub/cell-diff-reu-2018/data/coordinates_gene_counts_flow_cytometry.txt", row.names=1)
cleandata <- na.omit(rawdata) # remove rows with NA
data <- cleandata[,14:ncol(cleandata)] # choose relevant flow cytometry data
X <- as.matrix(data)
dataname <- "Nestorowa Gene Expression Data"

## create factor for grouping
rownames <- row.names(data)
groups <- as.character(rownames)
groups[grepl("HSPC",groups)] <- "HSPC" # replace all labels with hspc
groups[grepl("LT",groups)] <- "LT.HSC" # replace with lt.hsc
groups[grepl("Prog",groups)] <- "PROG" # same for prog
groupsf <- factor(groups)
nclusters <- nlevels(groupsf) # number of groups to cluster
colors <- rainbow(nclusters) # choose colors

## center data
M1centered <- scale(X, center=TRUE, scale=FALSE) # subtracts column means from each column

## svd
svd <- svd(M1centered, nu=3, nv=0)
U <- svd$u # dim: nrowx3

## calculate scores
scores <- t(M1centered) %*% U # columns of scores are the principal components, dim: ncolx3
```

2D plot of scores  
```{r pca-plot2dscores-nestorowa}
plot(x=scores[,1], y=scores[,2], 
     xlab="PC1 scores", ylab="PC2 scores", 
     col = colors[groupsf], 
     pch=20, 
     main = paste("PCA Scores (Handwritten),", dataname))
legend("topright", inset = c(0,0), 
       legend = levels(groupsf), 
       pch = 20, 
       col = colors, 
       ncol=1, cex=0.4)
```

3D plot of scores  
```{r pca-plot3dscores-nestorowa}
## plot scores 3d
plot3d(x=scores[,1], y=scores[,2], z=scores[,3], 
       xlab="PC1 scores", ylab="PC2 scores", zlab="PC3 scores", 
       col = colors[groupsf], 
       pch=20, 
       main = paste("PCA Scores (Handwritten),", dataname))
legend3d("bottomright", inset=c(0.2,0.2),
         legend = levels(groupsf),
         pch = 20, 
         col = colors, 
         ncol=1, cex=1)
rglwidget()
```


2D plot of PCs  
```{r pca-plot2dpcs-nestorowa}
## plot PCs 2d (eigenvectors of original covariance matrix)
plot(x=U[,1], y=U[,2], 
     xlab="PC1", ylab="PC2", 
     col = colors[groupsf], 
     pch=20, 
     main = paste("PCA (Handwritten),", dataname))
legend("topright", inset = c(0,0), 
       legend = levels(groupsf), 
       pch = 20, 
       col = colors, 
       ncol=1, 
       cex=0.4)
```

3D plot of PCs  
```{r pca-plot3d-pcs-nestorowa}
## plot PCs 3d
plot3d(x=U[,1], y=U[,2], z=U[,3], 
       xlab="PC1", ylab="PC2", zlab="PC3", 
       col = colors[groupsf], 
       pch=20, 
       main = paste("PCA (Handwritten),", dataname))
legend3d("bottomright", inset=c(0.2,0.2), 
         legend = levels(groupsf), 
         pch = 20, 
         col = colors, 
         ncol=1, cex=1)
rglwidget()
```


